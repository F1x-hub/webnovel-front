<div class="container">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <div class="card mt-4">
        <div class="card-header bg-primary text-white">
          <h2 class="card-title mb-0">Create New Novel</h2>
        </div>
        <div class="card-body">
          <form [formGroup]="novelForm" (ngSubmit)="onSubmit()">
            <!-- Alert messages -->
            <div *ngIf="errorMessage" class="alert alert-danger">
              {{ errorMessage }}
            </div>
            <div *ngIf="successMessage" class="alert alert-success">
              {{ successMessage }}
            </div>

            <!-- Title field -->
            <div class="mb-3">
              <label for="title" class="form-label">Title</label>
              <input
                type="text"
                id="title"
                formControlName="title"
                class="form-control"
                [ngClass]="{'is-invalid': novelForm.get('title')?.touched && novelForm.get('title')?.invalid}"
              >
              <div *ngIf="novelForm.get('title')?.touched && novelForm.get('title')?.invalid" class="invalid-feedback">
                <div *ngIf="novelForm.get('title')?.errors?.['required']">Title is required</div>
                <div *ngIf="novelForm.get('title')?.errors?.['minlength']">Title must be at least 3 characters long</div>
              </div>
            </div>

            <!-- Description field -->
            <div class="mb-3">
              <label for="description" class="form-label">Description</label>
              <textarea
                id="description"
                formControlName="description"
                class="form-control"
                rows="4"
                [ngClass]="{'is-invalid': novelForm.get('description')?.touched && novelForm.get('description')?.invalid}"
              ></textarea>
              <div *ngIf="novelForm.get('description')?.touched && novelForm.get('description')?.invalid" class="invalid-feedback">
                <div *ngIf="novelForm.get('description')?.errors?.['required']">Description is required</div>
                <div *ngIf="novelForm.get('description')?.errors?.['minlength']">Description must be at least 20 characters long</div>
              </div>
            </div>

            <!-- Cover Image field -->
            <div class="mb-3">
              <label for="coverImage" class="form-label">Cover Image</label>
              <input 
                type="file" 
                id="coverImage" 
                class="form-control" 
                accept="image/*"
                (change)="onFileSelected($event)"
              >
              <small class="form-text text-muted">Recommended size: 300x450 pixels (will be automatically resized to fit)</small>
              
              <!-- Image preview -->
              <div *ngIf="imagePreview" class="mt-3 text-center">
                <img [src]="imagePreview" alt="Cover preview" class="img-thumbnail" style="max-height: 450px; max-width: 300px; object-fit: cover;">
              </div>
            </div>

            <!-- Genres field -->
            <div class="mb-3">
              <label class="form-label">Genres</label>
              <div *ngIf="isLoading" class="text-center">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              <div class="genre-selection">
                <div *ngFor="let genre of genres" class="form-check">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    [id]="'genre-' + genre.id" 
                    [value]="genre.id"
                    [checked]="isGenreSelected(genre.id)"
                    (change)="onGenreChange(genre.id, $event)"
                  >
                  <label class="form-check-label" [for]="'genre-' + genre.id">
                    {{ genre.name }}
                  </label>
                </div>
              </div>
              <div *ngIf="novelForm.get('genreIds')?.touched && novelForm.get('genreIds')?.errors?.['required']" class="text-danger mt-1">
                Please select at least one genre
              </div>
            </div>

            <!-- Adult Content field -->
            <div class="mb-3">
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="isAdultContent"
                  formControlName="isAdultContent"
                >
                <label class="form-check-label" for="isAdultContent">
                  <strong>Adult Content</strong> - This novel contains adult themes (18+)
                </label>
              </div>
              <small class="form-text text-muted">
                Adult content will only be accessible to users who have verified their age as 18+
              </small>
            </div>

            <!-- Submit button -->
            <div class="d-grid gap-2">
              <button 
                type="submit" 
                class="btn btn-primary"
                [disabled]="isLoading"
              >
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                Create Novel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
